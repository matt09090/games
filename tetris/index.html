<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>High-Quality Tetris</title>
<style>
  body {
    display: flex;
    justify-content: center;
    align-items: flex-start;
    flex-direction: column;
    font-family: Arial, sans-serif;
    background: #111;
    color: #fff;
    margin: 0;
    padding: 20px;
    height: 100vh;
  }
  canvas {
    background: #222;
    display: block;
    margin: 20px auto;
    border: 2px solid #fff;
  }
  #controls {
    text-align: center;
    margin-bottom: 10px;
  }
  button {
    font-size: 16px;
    padding: 8px 16px;
    margin: 0 5px;
    cursor: pointer;
  }
  #scoreboard {
    text-align: center;
    margin-bottom: 10px;
  }
</style>
</head>
<body>

<div id="controls">
  <button id="startBtn">Start</button>
  <button id="resetBtn">Reset</button>
</div>

<div id="scoreboard">
  <div>Score: <span id="score">0</span></div>
  <div>High Score: <span id="highScore">0</span></div>
</div>

<canvas id="gameCanvas" width="240" height="400"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

const ROWS = 20;
const COLS = 10;
const BLOCK_SIZE = 20;

let board = Array.from({length: ROWS}, () => Array(COLS).fill(0));
let score = 0;
let highScore = 0;
let gameInterval;
let dropSpeed = 500;

const colors = [
  null,
  '#00f0f0', // I
  '#0000f0', // J
  '#f0a000', // L
  '#f0f000', // O
  '#00f000', // S
  '#a000f0', // T
  '#f00000'  // Z
];

const tetrominoes = [
  [],
  [[1,1,1,1]],                     // I
  [[2,0,0],[2,2,2]],               // J
  [[0,0,3],[3,3,3]],               // L
  [[4,4],[4,4]],                   // O
  [[0,5,5],[5,5,0]],               // S
  [[0,6,0],[6,6,6]],               // T
  [[7,7,0],[0,7,7]]                // Z
];

let currentPiece = null;
let pos = {x:0, y:0};

function drawBlock(x, y, color) {
  ctx.fillStyle = color;
  ctx.fillRect(x*BLOCK_SIZE, y*BLOCK_SIZE, BLOCK_SIZE, BLOCK_SIZE);
  ctx.strokeStyle = '#111';
  ctx.strokeRect(x*BLOCK_SIZE, y*BLOCK_SIZE, BLOCK_SIZE, BLOCK_SIZE);
}

function drawBoard() {
  ctx.clearRect(0,0,canvas.width, canvas.height);
  for(let y=0; y<ROWS; y++) {
    for(let x=0; x<COLS; x++) {
      if(board[y][x]) drawBlock(x,y,colors[board[y][x]]);
    }
  }
  if(currentPiece) {
    currentPiece.forEach((row, dy) => {
      row.forEach((value, dx) => {
        if(value) drawBlock(pos.x+dx, pos.y+dy, colors[value]);
      });
    });
  }
}

function collide() {
  for(let y=0; y<currentPiece.length; y++) {
    for(let x=0; x<currentPiece[y].length; x++) {
      if(currentPiece[y][x] &&
         (board[pos.y+y] && board[pos.y+y][pos.x+x]) !== 0) {
        return true;
      }
    }
  }
  return false;
}

function merge() {
  currentPiece.forEach((row, y) => {
    row.forEach((value, x) => {
      if(value) board[pos.y+y][pos.x+x] = value;
    });
  });
}

function rotate(piece) {
  return piece[0].map((_, i) => piece.map(row => row[i]).reverse());
}

function clearLines() {
  let lines = 0;
  outer: for(let y=ROWS-1; y>=0; y--) {
    for(let x=0; x<COLS; x++) {
      if(board[y][x] === 0) continue outer;
    }
    board.splice(y,1);
    board.unshift(Array(COLS).fill(0));
    lines++;
    y++;
  }
  if(lines>0) {
    score += lines * 10;
    if(score > highScore) highScore = score;
    document.getElementById('score').textContent = score;
    document.getElementById('highScore').textContent = highScore;
  }
}

function newPiece() {
  const type = Math.floor(Math.random()* (tetrominoes.length-1))+1;
  currentPiece = tetrominoes[type];
  pos = {x: Math.floor(COLS/2)-Math.floor(currentPiece[0].length/2), y:0};
  if(collide()) {
    clearInterval(gameInterval);
    alert("Game Over!");
  }
}

function move(dir) {
  pos.x += dir;
  if(collide()) pos.x -= dir;
}

function drop() {
  pos.y++;
  if(collide()) {
    pos.y--;
    merge();
    clearLines();
    newPiece();
  }
}

function hardDrop() {
  while(!collide()) pos.y++;
  pos.y--;
  merge();
  clearLines();
  newPiece();
}

function update() {
  drop();
  drawBoard();
}

document.addEventListener('keydown', e => {
  if(!currentPiece) return;
  if(e.key==='ArrowLeft') move(-1);
  if(e.key==='ArrowRight') move(1);
  if(e.key==='ArrowDown') drop();
  if(e.key==='ArrowUp') {
    const rotated = rotate(currentPiece);
    const old = currentPiece;
    currentPiece = rotated;
    if(collide()) currentPiece = old;
  }
  if(e.key===' ') hardDrop();
  drawBoard();
});

document.getElementById('startBtn').addEventListener('click', () => {
  if(gameInterval) clearInterval(gameInterval);
  board = Array.from({length: ROWS}, () => Array(COLS).fill(0));
  score = 0;
  document.getElementById('score').textContent = score;
  newPiece();
  drawBoard();
  gameInterval = setInterval(update, dropSpeed);
});

document.getElementById('resetBtn').addEventListener('click', () => {
  if(gameInterval) clearInterval(gameInterval);
  board = Array.from({length: ROWS}, () => Array(COLS).fill(0));
  score = 0;
  document.getElementById('score').textContent = score;
  drawBoard();
  currentPiece = null;
});

</script>
</body>
</html>
